<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM - Capital City Contractors</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f9fafb;
            overflow: hidden;
        }
        
        #crm-container {
            width: 100vw;
            height: 100vh;
            overflow: auto;
        }
        
        /* Loading screen */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999999;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #e5e7eb;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-top: 20px;
            color: #6b7280;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading CRM...</div>
    </div>
    
    <div id="crm-container"></div>

    <!-- Load CRM Dashboard Script -->
    <script src="crm-dashboard.js"></script>
    
    <script>
        // Initialize CRM when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Hide loading screen after CRM initializes
            setTimeout(() => {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    loadingScreen.style.transition = 'opacity 0.3s';
                    setTimeout(() => {
                        loadingScreen.remove();
                    }, 300);
                }
            }, 1000);
            
            // Override export/import functions to use Electron dialogs
            if (window.crmDashboard && window.electronAPI) {
                const originalExport = window.crmDashboard.exportAllData.bind(window.crmDashboard);
                const originalImport = window.crmDashboard.importData.bind(window.crmDashboard);
                
                window.crmDashboard.exportAllData = async function() {
                    const snapshot = {
                        contacts: this.contacts,
                        leads: this.leads,
                        projects: this.projects,
                        tasks: this.tasks,
                        campaigns: this.campaigns,
                        submissions: this.submissions,
                        discountCodes: this.discountCodes,
                        settings: this.settings,
                    };
                    
                    const result = await window.electronAPI.exportData(JSON.stringify(snapshot, null, 2));
                    if (result.success) {
                        alert(`✅ Data exported successfully to:\n${result.path}`);
                    }
                };
                
                window.crmDashboard.importData = async function() {
                    const result = await window.electronAPI.importData();
                    if (result.success) {
                        try {
                            const data = JSON.parse(result.data);
                            if (data.contacts) { this.contacts = data.contacts; this.save('ccc_contacts', this.contacts); }
                            if (data.leads) { this.leads = data.leads; this.save('ccc_leads', this.leads); }
                            if (data.projects) { this.projects = data.projects; this.save('ccc_projects', this.projects); }
                            if (data.tasks) { this.tasks = data.tasks; this.save('ccc_tasks', this.tasks); }
                            if (data.campaigns) { this.campaigns = data.campaigns; this.save('ccc_campaigns', this.campaigns); }
                            if (data.submissions) { this.submissions = data.submissions; this.save('ccc_submissions', this.submissions); }
                            if (data.discountCodes) { this.discountCodes = data.discountCodes; this.save('ccc_discount_codes', this.discountCodes); }
                            if (data.settings) { this.settings = data.settings; this.save('ccc_settings', this.settings); }
                            alert('✅ Data imported successfully!');
                            this.render();
                        } catch(e) {
                            alert('❌ Invalid data file!');
                        }
                    }
                };
            }
        });
    </script>
</body>
</html>

